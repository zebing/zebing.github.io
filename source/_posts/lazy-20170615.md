---
title: 图片懒加载
date: 2017-06-15 12:41:48
tags: [懒加载,javascript]
---


在那些图片比较多的网站，如果一开始就全部加载出来，不仅会严重拖慢网站的性能，给用户不好的体验，还会加载那些用户不会看到的图片，浪费用户的流量。这显然，不是我们所想要的。因此，我们必须要对这些图片加载进行优化，那就是懒加载。
### 什么是图片懒加载？
简单的说，图片懒加载就是只对那些要用到的图片进行加载，没用到的就不给它加载。
### 如何实现？
首先我们先获取所有的img节点

``` javAscript
	document.getElementsByTagName('img')
```
    
然后监听页面的scroll事件，页面一滑动，就加载那些需要显示的图片，另外为了不重复显示，在那些已经显示的图片，我们给它加一个属性data-load赋值true。

<!-- more -->
刚开始只加载三张图片
![text alt](http://orklhfurd.bkt.clouddn.com/lazy1.png)

随着页面的滑动，渐渐的加载剩下的图片
![text alt](http://orklhfurd.bkt.clouddn.com/lazy2.png)
下面是完整的例子

``` javascript
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>懒加载</title>
    <style type="text/css">
        html,body,ul{margin: 0;padding: 0;}
        li{list-style: none;width: 100%;min-height: 300px;box-shadow: 0 0 10px blue;overflow: hidden;}
        li:not(:first-child){margin: 20px 0;}
        .container{width: 300px; margin: 0 auto;}
    </style>
</head>
<body>
<div class="container">
    <ul>
        <li><img data-src="./image/1.jpg" width="100%"></li>
        <li><img data-src="./image/2.jpg" width="100%"></li>
        <li><img data-src="./image/3.jpg" width="100%"></li>
        <li><img data-src="./image/4.jpg" width="100%"></li>
        <li><img data-src="./image/5.jpg" width="100%"></li>
        <li><img data-src="./image/6.jpg" width="100%"></li>
        <li><img data-src="./image/8.jpg" width="100%"></li>
        <li><img data-src="./image/9.jpg" width="100%"></li>
        <li><img data-src="./image/10.jpg" width="100%"></li>
        <li><img data-src="./image/11.jpg" width="100%"></li>
    </ul>
</div>
<script type="text/javascript">
    function Lazy(){
        this.img = [];
        this.height; //视口高度
        this.beforeView = 10; //在视口之前10px加载
    }
    Lazy.prototype = {

        //下载图片
        loadImg: function() {
            this.img = this.img.length ? this.img : document.getElementsByTagName('img');
            for(var i = 0; i < this.img.length; i++) {
                if(this.isLoad(this.img[i])) {
                    if(!this.img[i].getAttribute('data-load')) {
                        this.img[i].src = this.img[i].getAttribute('data-src');
                        this.img[i].setAttribute('data-load', 'true')
                    }
                    
                }else{
                    return;
                }
            }
        },

        //判断是否继续下载图片
        isLoad: function(ele) {
            this.height = this.height ? this.height : (window.innerHeight || document.documentElement.clientHeight);
            var sh = document.body.scrollTop || document.documentElement.scrollTop; 
            var et = ele.offsetTop; 
            var ch = et - sh - this.beforeView;

            if(ch <= this.height) {
                return true; // 继续加载
            }else{
                return false; //停止加载
            }
        }
    }

    var lazy = new Lazy();
    lazy.loadImg();

    window.onscroll = function () {
        lazy.loadImg();
    }
</script>
</body>
</html>
```